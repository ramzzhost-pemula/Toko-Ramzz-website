<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jaksel Script IDE</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/vs-dark.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1e1e1e;
            color: #d4d4d4;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: #2d2d30;
            border-bottom: 1px solid #3e3e42;
            padding: 0.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 40px;
            transition: all 0.3s ease;
        }

        .title {
            font-size: 14px;
            color: #cccccc;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .title-icon {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .run-btn {
            background: linear-gradient(135deg, #0e639c, #1177bb);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            position: relative;
            overflow: hidden;
        }

        .run-btn:hover {
            background: linear-gradient(135deg, #1177bb, #1499dd);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(14, 99, 156, 0.3);
        }

        .run-btn:active {
            transform: translateY(0);
        }

        .run-btn.running {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .run-btn.running .run-icon {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .main-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .editor-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .editor-container.console-mode {
            transform: translateX(-100%);
        }

        .file-tab {
            background: #2d2d30;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #3e3e42;
            font-size: 12px;
            color: #cccccc;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .file-icon {
            color: #4fc1ff;
            transition: color 0.3s ease;
        }

        .CodeMirror {
            flex: 1;
            height: 100% !important;
            font-size: 14px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .console-container {
            position: absolute;
            top: 0;
            left: 100%;
            width: 100%;
            height: 100%;
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .console-container.show {
            transform: translateX(-100%);
        }

        .console-header {
            background: #2d2d30;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 35px;
        }

        .console-title {
            font-size: 12px;
            color: #cccccc;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .console-icon {
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .back-btn {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #5a6268, #495057);
            transform: translateY(-1px);
        }

        .console-output {
            flex: 1;
            padding: 1rem;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .continue-coding {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            margin: 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            animation: fadeInUp 0.8s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .continue-coding:hover {
            background: linear-gradient(135deg, #20c997, #17a2b8);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.3);
        }

        .error-line {
            color: #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
            padding: 0.4rem 0.8rem;
            border-left: 3px solid #ff6b6b;
            margin: 0.3rem 0;
            border-radius: 0 4px 4px 0;
            animation: slideInLeft 0.3s ease;
        }

        .success-line {
            color: #51cf66;
            animation: slideInLeft 0.3s ease;
        }

        .info-line {
            color: #74c0fc;
            animation: slideInLeft 0.3s ease;
        }

        .output-line {
            color: #ced4da;
            padding: 0.2rem 0;
            animation: slideInLeft 0.3s ease;
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .status-bar {
            background: #007acc;
            color: white;
            padding: 0.2rem 1rem;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 22px;
            transition: all 0.3s ease;
        }

        .status-bar.error-status {
            background: #dc3545;
            animation: shake 0.5s ease;
        }

        .status-bar.success-status {
            background: #28a745;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .syntax-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .line-info {
            font-size: 11px;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e1e1e;
        }

        ::-webkit-scrollbar-thumb {
            background: #424242;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4f4f4f;
        }

        /* Custom CodeMirror styling for syntax colors */
        .CodeMirror-gutters {
            background: #1e1e1e !important;
            border-right: 1px solid #3e3e42 !important;
        }

        .CodeMirror-linenumber {
            color: #6e7681 !important;
        }

        .CodeMirror-activeline-background {
            background: rgba(255, 255, 255, 0.04) !important;
        }

        /* Custom syntax highlighting for Jaksel Script */
        .cm-jaksel-keyword {
            color: #569cd6 !important;
            font-weight: bold;
        }

        .cm-jaksel-string {
            color: #ce9178 !important;
        }

        .cm-jaksel-variable {
            color: #9cdcfe !important;
        }

        .cm-jaksel-operator {
            color: #d4d4d4 !important;
        }

        .cm-jaksel-number {
            color: #b5cea8 !important;
        }

        .error-indicator {
            position: absolute;
            top: 50%;
            right: 1rem;
            transform: translateY(-50%);
            background: #dc3545;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            font-size: 10px;
            animation: bounce 0.5s ease;
            z-index: 1000;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(-50%); }
            40% { transform: translateY(-60%); }
            60% { transform: translateY(-55%); }
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">
            <span class="title-icon">🚀</span>
            Jaksel Script IDE - main.jaksel
        </div>
        <div class="controls">
            <button class="run-btn" onclick="runCode()" id="runButton">
                <span class="run-icon">▶️</span>
                Run Code
            </button>
        </div>
    </div>

    <div class="main-container">
        <div class="editor-container" id="editorContainer">
            <div class="file-tab">
                <span class="file-icon">📄</span>
                main.jaksel
                <div class="error-indicator" id="errorIndicator" style="display: none;">
                    Error!
                </div>
            </div>
            <textarea id="code-editor"></textarea>
        </div>

        <div class="console-container" id="consoleContainer">
            <div class="console-header">
                <div class="console-title">
                    <span class="console-icon">🖥️</span>
                    Console Output
                </div>
                <button class="back-btn" onclick="backToEditor()">
                    ← Kembali ke Editor
                </button>
            </div>
            <div id="console-output" class="console-output"></div>
            <button class="continue-coding" onclick="backToEditor()">
                Lanjutkan Codingannya :)
            </button>
        </div>
    </div>

    <div class="status-bar" id="statusBar">
        <div class="syntax-indicator">
            <span>Jaksel Script</span>
            <span>•</span>
            <span>UTF-8</span>
            <span>•</span>
            <span id="statusMessage">Ready</span>
        </div>
        <div class="line-info" id="lineInfo">Ln 1, Col 1</div>
    </div>

    <script>
        // Custom mode for Jaksel Script syntax highlighting
        CodeMirror.defineMode("jaksel", function() {
            const keywords = ["literally", "spill", "kalo", "udahan", "itu", "lebih", "gede", "kecil", "sama", "dengan"];
            
            return {
                token: function(stream, state) {
                    if (stream.match(/\/\/.*/)) {
                        return "comment";
                    }
                    
                    if (stream.match(/"[^"]*"/) || stream.match(/'[^']*'/)) {
                        return "jaksel-string";
                    }
                    
                    if (stream.match(/\d+(\.\d+)?/)) {
                        return "jaksel-number";
                    }
                    
                    if (stream.match(/[+\-*/=]/)) {
                        return "jaksel-operator";
                    }
                    
                    let word = "";
                    while (stream.peek() && /\w/.test(stream.peek())) {
                        word += stream.next();
                    }
                    
                    if (keywords.includes(word)) {
                        return "jaksel-keyword";
                    } else if (word) {
                        return "jaksel-variable";
                    }
                    
                    stream.next();
                    return null;
                }
            };
        });

        // Initialize CodeMirror
        const editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
            mode: 'jaksel',
            theme: 'vs-dark',
            lineNumbers: true,
            autoCloseBrackets: true,
            matchBrackets: true,
            indentUnit: 2,
            tabSize: 2,
            lineWrapping: true,
            cursorBlinkRate: 530,
            showCursorWhenSelecting: true,
        });

        // Set default code
        editor.setValue(`literally nama itu "Bestie"
literally umur itu 21

spill "Hello World!"
spill "Hai " + nama + ", umur lu " + umur + " tahun"
spill "Selamat datang di Jaksel Script!"

kalo umur lebih gede 18
  spill "Lu udah dewasa cuy!"
udahan`);

        // Update line info and status
        editor.on('cursorActivity', function() {
            const cursor = editor.getCursor();
            document.getElementById('lineInfo').textContent = `Ln ${cursor.line + 1}, Col ${cursor.ch + 1}`;
        });

        editor.on('change', function() {
            const statusBar = document.getElementById('statusBar');
            const errorIndicator = document.getElementById('errorIndicator');
            statusBar.className = 'status-bar';
            errorIndicator.style.display = 'none';
            updateStatusMessage('Modified');
        });

        // Jaksel Script Interpreter
        class JakselInterpreter {
            constructor() {
                this.variables = {};
                this.output = [];
                this.hasError = false;
                this.errorLine = null;
            }

            clear() {
                this.variables = {};
                this.output = [];
                this.hasError = false;
                this.errorLine = null;
            }

            log(message, type = 'normal', delay = 0) {
                setTimeout(() => {
                    const className = type === 'error' ? 'error-line' : 
                                     type === 'success' ? 'success-line' :
                                     type === 'info' ? 'info-line' : 'output-line';
                    
                    this.output.push({
                        text: message,
                        class: className
                    });
                    
                    if (type === 'error') {
                        this.updateConsoleOutput();
                    }
                }, delay);
            }

            error(message, lineNumber = null) {
                this.hasError = true;
                this.errorLine = lineNumber;
                const errorMsg = lineNumber ? 
                    `❌ Error at line ${lineNumber}: ${message}` : 
                    `❌ ${message}`;
                this.log(errorMsg, 'error');
            }

            success(message) {
                this.log(`✅ ${message}`, 'success');
            }

            info(message) {
                this.log(`ℹ️ ${message}`, 'info');
            }

            updateConsoleOutput() {
                const consoleElement = document.getElementById('console-output');
                consoleElement.innerHTML = this.output.map(item => 
                    `<div class="${item.class}">${item.text}</div>`
                ).join('');
                consoleElement.scrollTop = consoleElement.scrollHeight;
            }

            async interpret(code) {
                this.clear();
                updateStatusMessage('Running<span class="loading-dots"></span>');
                
                const runButton = document.getElementById('runButton');
                runButton.classList.add('running');
                runButton.innerHTML = '<span class="run-icon">⚡</span> Running...';
                
                await new Promise(resolve => setTimeout(resolve, 300)); // Small delay for UX
                
                try {
                    const lines = code.split('\n').map((line, index) => ({
                        content: line.trim(),
                        number: index + 1
                    })).filter(line => line.content);
                    
                    if (lines.length === 0) {
                        this.info("No code to execute");
                        return this.finishExecution(runButton);
                    }

                    this.info("🚀 Starting Jaksel Script execution...");
                    await new Promise(resolve => setTimeout(resolve, 200));

                    let i = 0;
                    while (i < lines.length && !this.hasError) {
                        i = await this.executeLine(lines, i);
                    }

                    if (!this.hasError) {
                        await new Promise(resolve => setTimeout(resolve, 300));
                        this.success("Program executed successfully! 🎉");
                        updateStatusMessage('Execution completed', 'success');
                    } else {
                        updateStatusMessage('Execution failed', 'error');
                        const errorIndicator = document.getElementById('errorIndicator');
                        errorIndicator.style.display = 'block';
                        setTimeout(() => {
                            errorIndicator.style.display = 'none';
                        }, 3000);
                    }
                } catch (error) {
                    this.error(`Runtime error: ${error.message}`);
                    updateStatusMessage('Runtime error', 'error');
                }

                return this.finishExecution(runButton);
            }

            finishExecution(runButton) {
                runButton.classList.remove('running');
                runButton.innerHTML = '<span class="run-icon">▶️</span> Run Code';
                
                this.updateConsoleOutput();
                return this.output;
            }

            async executeLine(lines, currentIndex) {
                const line = lines[currentIndex];
                if (!line.content) return currentIndex + 1;

                try {
                    this.updateConsoleOutput();
                    await new Promise(resolve => setTimeout(resolve, 100)); // Animation delay

                    // literally - variable declaration
                    if (line.content.startsWith('literally ')) {
                        const match = line.content.match(/^literally\s+(\w+)\s+itu\s+(.+)$/);
                        if (match) {
                            const varName = match[1];
                            const value = this.evaluateExpression(match[2]);
                            this.variables[varName] = value;
                            this.info(`📦 Variable '${varName}' = ${JSON.stringify(value)}`);
                        } else {
                            this.error(`Invalid syntax. Expected: literally [variable] itu [value]`, line.number);
                        }
                        return currentIndex + 1;
                    }

                    // spill - print statement
                    if (line.content.startsWith('spill ')) {
                        const content = line.content.substring(6).trim();
                        const result = this.evaluateExpression(content);
                        this.log(result, 'normal');
                        return currentIndex + 1;
                    }

                    // kalo - if statement
                    if (line.content.startsWith('kalo ')) {
                        return await this.executeKalo(lines, currentIndex);
                    }

                    this.error(`Unknown command: ${line.content}`, line.number);
                } catch (error) {
                    this.error(error.message, line.number);
                }

                return currentIndex + 1;
            }

            async executeKalo(lines, startIndex) {
                const condition = lines[startIndex].content.substring(5).trim();
                let conditionResult = false;
                
                try {
                    conditionResult = this.evaluateCondition(condition);
                    this.info(`🤔 Condition '${condition}' → ${conditionResult ? 'true' : 'false'}`);
                } catch (error) {
                    this.error(`Invalid condition: ${condition}`, lines[startIndex].number);
                    return this.findUdahan(lines, startIndex) + 1;
                }
                
                let i = startIndex + 1;
                
                while (i < lines.length) {
                    const line = lines[i];
                    
                    if (line.content === 'udahan') {
                        break;
                    }
                    
                    if (conditionResult) {
                        i = await this.executeLine(lines, i);
                    } else {
                        i++;
                    }
                }
                
                if (i >= lines.length) {
                    this.error("Missing 'udahan' for 'kalo' statement", lines[startIndex].number);
                }
                
                return i + 1;
            }

            findUdahan(lines, startIndex) {
                for (let i = startIndex + 1; i < lines.length; i++) {
                    if (lines[i].content === 'udahan') {
                        return i;
                    }
                }
                return lines.length - 1;
            }

            evaluateCondition(condition) {
                if (condition.includes(' lebih gede ')) {
                    const parts = condition.split(' lebih gede ');
                    if (parts.length !== 2) throw new Error("Invalid 'lebih gede' syntax");
                    const left = this.evaluateExpression(parts[0].trim());
                    const right = this.evaluateExpression(parts[1].trim());
                    return Number(left) > Number(right);
                }
                
                if (condition.includes(' lebih kecil ')) {
                    const parts = condition.split(' lebih kecil ');
                    if (parts.length !== 2) throw new Error("Invalid 'lebih kecil' syntax");
                    const left = this.evaluateExpression(parts[0].trim());
                    const right = this.evaluateExpression(parts[1].trim());
                    return Number(left) < Number(right);
                }
                
                if (condition.includes(' sama dengan ')) {
                    const parts = condition.split(' sama dengan ');
                    if (parts.length !== 2) throw new Error("Invalid 'sama dengan' syntax");
                    const left = this.evaluateExpression(parts[0].trim());
                    const right = this.evaluateExpression(parts[1].trim());
                    return left == right;
                }
                
                return Boolean(this.evaluateExpression(condition));
            }

            evaluateExpression(expr) {
                expr = expr.trim();
                
                if ((expr.startsWith('"') && expr.endsWith('"')) ||
                    (expr.startsWith("'") && expr.endsWith("'"))) {
                    return expr.slice(1, -1);
                }
                
                if (/^\d+(\.\d+)?$/.test(expr)) {
                    return parseFloat(expr);
                }
                
                if (/^\w+$/.test(expr) && this.variables[expr] !== undefined) {
                    return this.variables[expr];
                }

                return this.evaluateOperation(expr);
            }

            evaluateOperation(expr) {
                if (expr.includes(' + ')) {
                    const parts = expr.split(' + ');
                    let result = '';
                    for (let part of parts) {
                        const value = this.evaluateExpression(part.trim());
                        result += String(value);
                    }
                    return result;
                }
                
                if (expr.includes(' - ')) {
                    const parts = expr.split(' - ');
                    let result = this.evaluateExpression(parts[0].trim());
                    for (let i = 1; i < parts.length; i++) {
                        result -= this.evaluateExpression(parts[i].trim());
                    }
                    return result;
                }
                
                if (expr.includes(' * ')) {
                    const parts = expr.split(' * ');
                    let result = this.evaluateExpression(parts[0].trim());
                    for (let i = 1; i < parts.length; i++) {
                        result *= this.evaluateExpression(parts[i].trim());
                    }
                    return result;
                }
                
                if (expr.includes(' / ')) {
                    const parts = expr.split(' / ');
                    let result = this.evaluateExpression(parts[0].trim());
                    for (let i = 1; i < parts.length; i++) {
                        const divisor = this.evaluateExpression(parts[i].trim());
                        if (divisor === 0) throw new Error("Division by zero");
                        result /= divisor;
                    }
                    return result;
                }
                
                if (this.variables[expr] !== undefined) {
                    return this.variables[expr];
                }
                
                throw new Error(`Unknown variable or expression: ${expr}`);
            }
        }

        const interpreter = new JakselInterpreter();

        function updateStatusMessage(message, type = null) {
            const statusBar = document.getElementById('statusBar');
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.innerHTML = message;
            
            if (type === 'error') {
                statusBar.className = 'status-bar error-status';
            } else if (type === 'success') {
                statusBar.className = 'status-bar success-status';
            } else {
                statusBar.className = 'status-bar';
            }
        }

        async function runCode() {
            const code = editor.getValue();
            
            // Switch to console
            const editorContainer = document.getElementById('editorContainer');
            const consoleContainer = document.getElementById('consoleContainer');
            
            editorContainer.classList.add('console-mode');
            consoleContainer.classList.add('show');
            
            // Clear console and run code
            document.getElementById('console-output').innerHTML = '';
            await interpreter.interpret(code);
        }

        function backToEditor() {
            const editorContainer = document.getElementById('editorContainer');
            const consoleContainer = document.getElementById('consoleContainer');
            
            editorContainer.classList.remove('console-mode');
            consoleContainer.classList.remove('show');
            
            setTimeout(() => {
                editor.focus();
                updateStatusMessage('Ready');
            }, 300);
        }

        // Keyboard shortcuts
        editor.setOption("extraKeys", {
            "Ctrl-Enter": runCode,
            "Cmd-Enter": runCode,
            "F5": runCode,
            "Escape": backToEditor
        });

        // Focus editor on load
        editor.focus();
        updateStatusMessage('Ready to code! 🚀');
    </script>
</body>
</html>
